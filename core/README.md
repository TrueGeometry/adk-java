# Agent Development Kit (ADK) for Java
## Setting up PostgreSQL as a persistence store
[![License](https://img.shields.io/badge/License-Apache_2.0-blue.svg)](LICENSE)
[![r/agentdevelopmentkit](https://img.shields.io/badge/Reddit-r%2Fagentdevelopmentkit-FF4500?style=flat&logo=reddit&logoColor=white)](https://www.reddit.com/r/agentdevelopmentkit/)

--------------------------------------------------------------------------------

## âœ¨ Key Features

-   **External Configuration**: The database connection details are defined as constants, with a clear note that in a production environment, these should be managed through secure environment variables to protect sensitive information.

### 1. Install PostgreSQL

Refer to the [official documentation](https://www.postgresql.org/download/) for installation instructions for your platform.

### 2. Start PostgreSQL Service

```sh
# On macOS (Homebrew)
brew services start postgresql

# On Ubuntu/Debian
sudo service postgresql start
```

### 3. Create a Database

```sh
createdb adk_db
```

### 4. Connect to the Database

```sh
psql adk_db
```
## Table structure since in ADK will have Seesion,Events and event_content_parts

### 5. Create a session table for all the sessions.

```sql
CREATE TABLE sessions (
    id VARCHAR(255) PRIMARY KEY,       -- Unique identifier for the session, often a UUID or a unique string
    app_name VARCHAR(255) NOT NULL,    -- Name of the application associated with the session
    user_id VARCHAR(255) NOT NULL,     -- Identifier for the user who owns the session
    state JSONB DEFAULT '{}',
    event_data JSONB DEFAULT '[]',-- Current state of the session (e.g., JSON, text description)
    last_update_time TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP -- Timestamp of the last update, defaults to current time
);
```
--------------------------------------------------------------------------------
### 6. Create a events table for all the events 

```sql
CREATE TABLE IF NOT EXISTS events (
    id VARCHAR(255) PRIMARY KEY,-- This is also unique id generated by events
    session_id VARCHAR(255) NOT NULL, -- same as session id
    author VARCHAR(100),-- basically user or super agent or subagent
    actions_state_delta JSONB DEFAULT '{}',
    actions_artifact_delta JSONB DEFAULT '{}',
    actions_requested_auth_configs JSONB DEFAULT '{}',
    actions_transfer_to_agent VARCHAR(255),
    content_role VARCHAR(50),
    timestamp BIGINT,
    invocation_id VARCHAR(255),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT fk_events_session FOREIGN KEY (session_id)
        REFERENCES sessions(id) ON DELETE CASCADE
);
```
--------------------------------------------------------------------------------
### 7. Create a event_content_parts for all the sessions Table

```sql
CREATE TABLE IF NOT EXISTS event_content_parts (
    event_id VARCHAR(255) PRIMARY KEY,--Here to no bloating DB with duplicate insert using same event id as primary key
    session_id VARCHAR(255) NOT NULL,
    part_type VARCHAR(50),
    text_content TEXT,
    function_call_id VARCHAR(255),
    function_call_name VARCHAR(255),
    function_call_args JSONB,
    function_response_id VARCHAR(255),
    function_response_name VARCHAR(255),
    function_response_data JSONB,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT fk_parts_event FOREIGN KEY (event_id)
        REFERENCES events(id) ON DELETE CASCADE,
    CONSTRAINT fk_parts_session FOREIGN KEY (session_id)
        REFERENCES sessions(id) ON DELETE CASCADE
);
```
--------------------------------------------------------------------------------

### 8. Insert Data

```sql
ON CONFLICT (with column Name) we are using to avoid duplicates
```

### 9. Query Data

```sql
select * from sessions s 
select * from events
select * from event_content_parts ecp 
```

### *. Delete with cascade
delete from  sessions where id ='asasawe11'
This will take care of deleting from all other table in case needed.

